# å¦‚ä½•æ·»åŠ å’Œä½¿ç”¨ Spine åŠ¨ç”»

## ğŸ“‹ å½“å‰å¯ç”¨çš„åŠ¨ç”»åˆ—è¡¨

æ ¹æ® `mon_earth_dragon_01_v38` èµ„æºæ–‡ä»¶ï¼Œä»¥ä¸‹æ˜¯æ‰€æœ‰å¯ç”¨çš„åŠ¨ç”»ï¼š

| åŠ¨ç”»åç§° | ç”¨é€”å»ºè®® | è§¦å‘åœºæ™¯ |
|---------|---------|---------|
| `idle1` | æ´»æ³¼å¾…æœº | å¿«ä¹åº¦ä¸­ç­‰æ—¶ |
| `idle2` | é»˜è®¤å¾…æœº | æ­£å¸¸çŠ¶æ€ |
| `start` | å‡ºåœºåŠ¨ç”» | å® ç‰©é¦–æ¬¡å‡ºç° |
| `attack1a` | æ”»å‡»A | é¥¥é¥¿/ä¸å®‰ |
| `attack1b` | æ”»å‡»B | æˆ˜æ–—åœºæ™¯ |
| `attack1c` | æ”»å‡»Cï¼ˆåä¸½ï¼‰ | å¿«ä¹/å…´å¥‹ |
| `attack1d` | æ”»å‡»D | æˆ˜æ–—åœºæ™¯ |
| `attack1e` | æ”»å‡»E | æˆ˜æ–—åœºæ™¯ |
| `attack2a` | å¼ºåŠ›æ”»å‡»A | ç‰¹æ®ŠæŠ€èƒ½ |
| `attack2b` | å¼ºåŠ›æ”»å‡»B | ç‰¹æ®ŠæŠ€èƒ½ |
| `catch` | æ•æ‰åŠ¨ä½œ | äº’åŠ¨åœºæ™¯ |
| `hitback` | å—å‡» | è¢«æ”»å‡»æ—¶ |
| `die` | æ¿’æ­» | å¥åº·åº¦æä½ |

## ğŸ¯ æ–¹æ³•ä¸€ï¼šå›ºå®šä½¿ç”¨æŸä¸ªåŠ¨ç”»ï¼ˆæµ‹è¯•ç”¨ï¼‰

### 1. ä¿®æ”¹ `PetDisplay.tsx`

```typescript
export const PetDisplay: React.FC<PetDisplayProps> = ({ pet }) => {
  // å›ºå®šä½¿ç”¨æŸä¸ªåŠ¨ç”»
  const currentAnimation = 'idle2'; // æ”¹æˆä½ æƒ³è¦çš„åŠ¨ç”»åç§°
  
  return (
    <View style={styles.container}>
      <View style={styles.petPlatform}>
        <SpinePet pet={pet} animation={currentAnimation} />
        <View style={styles.shadow} />
      </View>
    </View>
  );
};
```

### 2. æµ‹è¯•ä¸åŒåŠ¨ç”»

ä¾æ¬¡å°è¯•è¿™äº›åŠ¨ç”»ï¼Œçœ‹çœ‹æ•ˆæœï¼š
- `'idle2'` - é»˜è®¤å¾…æœº
- `'idle1'` - æ´»æ³¼å¾…æœº
- `'attack1c'` - åä¸½åŠ¨ä½œ
- `'start'` - å‡ºåœºåŠ¨ç”»

## ğŸ® æ–¹æ³•äºŒï¼šæ ¹æ®å® ç‰©çŠ¶æ€åŠ¨æ€åˆ‡æ¢

### 1. åŸºç¡€ç‰ˆæœ¬ï¼ˆç®€å•æ¡ä»¶ï¼‰

```typescript
export const PetDisplay: React.FC<PetDisplayProps> = ({ pet }) => {
  const currentAnimation = useMemo(() => {
    if (pet.hunger < 30) return 'attack1a';  // é¥¥é¥¿
    if (pet.happiness > 80) return 'attack1c'; // å¼€å¿ƒ
    return 'idle2'; // é»˜è®¤
  }, [pet.hunger, pet.happiness]);
  
  return (
    <View style={styles.container}>
      <View style={styles.petPlatform}>
        <SpinePet pet={pet} animation={currentAnimation} />
        <View style={styles.shadow} />
      </View>
    </View>
  );
};
```

### 2. å®Œæ•´ç‰ˆæœ¬ï¼ˆå¤šç§çŠ¶æ€ï¼‰

```typescript
export const PetDisplay: React.FC<PetDisplayProps> = ({ pet }) => {
  const currentAnimation = useMemo(() => {
    // æ¿’æ­»çŠ¶æ€ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
    if (pet.health < 20) return 'die';
    
    // é¥¥é¥¿çŠ¶æ€
    if (pet.hunger < 30) return 'attack1a';
    
    // éå¸¸å¼€å¿ƒ
    if (pet.happiness > 80) return 'attack1c';
    
    // æ¯”è¾ƒå¼€å¿ƒ
    if (pet.happiness > 60) return 'idle1';
    
    // é»˜è®¤å¾…æœº
    return 'idle2';
  }, [pet.hunger, pet.happiness, pet.health]);
  
  return (
    <View style={styles.container}>
      <View style={styles.petPlatform}>
        <SpinePet pet={pet} animation={currentAnimation} />
        <View style={styles.shadow} />
      </View>
    </View>
  );
};
```

## ğŸ¨ æ–¹æ³•ä¸‰ï¼šæ ¹æ®ç”¨æˆ·æ“ä½œè§¦å‘åŠ¨ç”»

### 1. åœ¨ `PetDisplay.tsx` ä¸­æ·»åŠ çŠ¶æ€

```typescript
export const PetDisplay: React.FC<PetDisplayProps> = ({ pet }) => {
  const [actionAnimation, setActionAnimation] = useState<string | null>(null);
  
  const currentAnimation = useMemo(() => {
    // å¦‚æœæœ‰ä¸´æ—¶åŠ¨ç”»ï¼Œä¼˜å…ˆæ’­æ”¾
    if (actionAnimation) return actionAnimation;
    
    // å¦åˆ™æ ¹æ®çŠ¶æ€å†³å®š
    if (pet.hunger < 30) return 'attack1a';
    if (pet.happiness > 80) return 'attack1c';
    return 'idle2';
  }, [pet.hunger, pet.happiness, actionAnimation]);
  
  // æ’­æ”¾ä¸´æ—¶åŠ¨ç”»ï¼Œ3ç§’åæ¢å¤
  const playAnimation = (animName: string) => {
    setActionAnimation(animName);
    setTimeout(() => setActionAnimation(null), 3000);
  };
  
  return (
    <View style={styles.container}>
      <View style={styles.petPlatform}>
        <SpinePet pet={pet} animation={currentAnimation} />
        <View style={styles.shadow} />
      </View>
      
      {/* æµ‹è¯•æŒ‰é’® */}
      <TouchableOpacity onPress={() => playAnimation('attack1c')}>
        <Text>æ’­æ”¾åä¸½åŠ¨ä½œ</Text>
      </TouchableOpacity>
    </View>
  );
};
```

### 2. åœ¨ `App.tsx` ä¸­é›†æˆåˆ°äº’åŠ¨æŒ‰é’®

```typescript
// ä¿®æ”¹å–‚é£Ÿå‡½æ•°
const handleFeed = async () => {
  await feed();
  // æ’­æ”¾è¿›é£ŸåŠ¨ç”»ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
  // æˆ–è€…æ’­æ”¾å¼€å¿ƒåŠ¨ç”»
};

// ä¿®æ”¹ç©è€å‡½æ•°
const handlePlay = async () => {
  await play();
  // æ’­æ”¾ attack1cï¼ˆå¼€å¿ƒåŠ¨ä½œï¼‰
};
```

## ğŸ”§ æ–¹æ³•å››ï¼šæ·»åŠ åŠ¨ç”»é˜Ÿåˆ—ç³»ç»Ÿ

å¦‚æœä½ æƒ³è¦æ›´å¤æ‚çš„åŠ¨ç”»ç³»ç»Ÿï¼ˆæ¯”å¦‚è¿ç»­æ’­æ”¾å¤šä¸ªåŠ¨ç”»ï¼‰ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªåŠ¨ç”»ç®¡ç†å™¨ï¼š

```typescript
// src/hooks/useAnimationQueue.ts
export const useAnimationQueue = (defaultAnimation: string) => {
  const [queue, setQueue] = useState<string[]>([]);
  const [current, setCurrent] = useState(defaultAnimation);
  
  const playAnimation = (animName: string, duration: number = 3000) => {
    setQueue(prev => [...prev, animName]);
    
    setTimeout(() => {
      setQueue(prev => prev.slice(1));
    }, duration);
  };
  
  useEffect(() => {
    if (queue.length > 0) {
      setCurrent(queue[0]);
    } else {
      setCurrent(defaultAnimation);
    }
  }, [queue, defaultAnimation]);
  
  return { current, playAnimation };
};
```

## ğŸ› è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹å½“å‰æ’­æ”¾çš„åŠ¨ç”»

åœ¨æµè§ˆå™¨æ§åˆ¶å°è¾“å…¥ï¼š
```javascript
// æŸ¥çœ‹ Spine Player å®ä¾‹
console.log(window.spinePlayer);

// æŸ¥çœ‹å½“å‰åŠ¨ç”»
console.log(window.spinePlayer?.animationState);
```

### 2. æ‰‹åŠ¨åˆ‡æ¢åŠ¨ç”»

åœ¨æ§åˆ¶å°è¾“å…¥ï¼š
```javascript
// å‡è®¾ä½ çš„ playerRef å¯ä»¥è®¿é—®
playerRef.current.setAnimation('attack1c', true);
```

### 3. æŸ¥çœ‹æ‰€æœ‰å¯ç”¨åŠ¨ç”»

```javascript
playerRef.current.skeleton.data.animations.forEach(anim => {
  console.log(anim.name);
});
```

## ğŸ“ æœ€ä½³å®è·µ

1. **ä¼˜å…ˆçº§æ’åº**ï¼šæŠŠæœ€é‡è¦çš„çŠ¶æ€æ”¾åœ¨æœ€å‰é¢åˆ¤æ–­
2. **é¿å…é¢‘ç¹åˆ‡æ¢**ï¼šä½¿ç”¨ `useMemo` é¿å…ä¸å¿…è¦çš„åŠ¨ç”»åˆ‡æ¢
3. **æ·»åŠ è¿‡æ¸¡**ï¼šè€ƒè™‘æ·»åŠ åŠ¨ç”»ä¹‹é—´çš„è¿‡æ¸¡æ•ˆæœ
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šä¸è¦åœ¨æ¯ä¸€å¸§éƒ½åˆ‡æ¢åŠ¨ç”»
5. **ç”¨æˆ·ä½“éªŒ**ï¼šç¡®ä¿åŠ¨ç”»åˆ‡æ¢æµç•…è‡ªç„¶

## ğŸ¬ ç¤ºä¾‹ï¼šå®Œæ•´çš„åŠ¨ç”»ç³»ç»Ÿ

```typescript
// PetDisplay.tsx
export const PetDisplay: React.FC<PetDisplayProps> = ({ pet }) => {
  const [tempAnimation, setTempAnimation] = useState<string | null>(null);
  
  // åŸºç¡€åŠ¨ç”»é€»è¾‘
  const baseAnimation = useMemo(() => {
    if (pet.health < 20) return 'die';
    if (pet.hunger < 30) return 'attack1a';
    if (pet.happiness > 80) return 'attack1c';
    if (pet.happiness > 60) return 'idle1';
    return 'idle2';
  }, [pet.hunger, pet.happiness, pet.health]);
  
  // å½“å‰åŠ¨ç”»ï¼ˆä¸´æ—¶åŠ¨ç”»ä¼˜å…ˆï¼‰
  const currentAnimation = tempAnimation || baseAnimation;
  
  // æ’­æ”¾ä¸´æ—¶åŠ¨ç”»
  const playTempAnimation = useCallback((animName: string, duration: number = 2000) => {
    setTempAnimation(animName);
    setTimeout(() => setTempAnimation(null), duration);
  }, []);
  
  // ç›‘å¬å® ç‰©çŠ¶æ€å˜åŒ–ï¼Œè§¦å‘ç‰¹æ®ŠåŠ¨ç”»
  useEffect(() => {
    if (pet.happiness > 90) {
      playTempAnimation('attack1c', 3000);
    }
  }, [pet.happiness, playTempAnimation]);
  
  return (
    <View style={styles.container}>
      <View style={styles.petPlatform}>
        <SpinePet pet={pet} animation={currentAnimation} />
        <View style={styles.shadow} />
      </View>
    </View>
  );
};
```

## ğŸš€ ä¸‹ä¸€æ­¥

1. å…ˆç”¨å›ºå®šåŠ¨ç”»æµ‹è¯•ï¼Œç¡®ä¿èƒ½çœ‹åˆ°åŠ¨ç”»æ’­æ”¾
2. ç„¶åæ·»åŠ ç®€å•çš„æ¡ä»¶åˆ¤æ–­
3. æœ€åå®ç°å®Œæ•´çš„åŠ¨ç”»ç³»ç»Ÿ
4. è€ƒè™‘æ·»åŠ éŸ³æ•ˆé…åˆåŠ¨ç”»
